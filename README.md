# Barter Platform

Платформа для обмена товарами и услугами между пользователями.  
Позволяет публиковать объявления, предлагать обмен, управлять своими сделками.  
Поддерживает как веб-интерфейс, так и REST API.

## Функциональность
- Регистрация и аутентификация пользователей
- CRUD для объявлений
- Создание предложений на обмен
- Управление своими обменами
- REST API для интеграций


## Клонирование репозитория и переход в директорию
1. Клонировать репозиторий с проектом:

    ```bash
    git clone <URL_репозитория>
    ```

    Заменить `<URL_репозитория>` на фактический URL репозитория (например, на GitHub).

2. Перейти в директорию проекта:

    ```bash
    cd <имя_папки_с_проектом>
    ```

    Заменить `<имя_папки_с_проектом>` на имя папки, которая была создана при клонировании репозитория.


## Установка
1. Создать виртуальное окружение:
    ```bash
    python3 -m venv venv
    ```

2. Активировать виртуальное окружение:
    - Для Linux/MacOS:
      ```bash
      source venv/bin/activate
      ```
    - Для Windows:
      ```bash
      .\venv\Scripts\activate
      ```

3. Установить зависимости:
    ```bash
    pip install -r requirements.txt
    ```

4. Создать файл `.env` на основе `.env.example` и настроить параметры окружения:
    В файле `.env` указать следующие переменные:
    - `DEBUG=True`
    - `SECRET_KEY=<your_secret_key>`
    - `DB_NAME=<your_db_name>`
    - `DB_USER=<your_db_user>`
    - `DB_PASSWORD=<your_db_password>`
    - `DB_HOST=localhost`
    - `DB_PORT=5432`

---


## Миграции базы данных
1. Создать миграции для приложения:
    ```bash
    python manage.py makemigrations
    ```

2. Применить миграции для создания таблиц в базе данных:
    ```bash
    python manage.py migrate
    ```

3. Для создания суперпользователя (если необходимо):
    ```bash
    python manage.py createsuperuser
    ```

4. Проверить корректность работы приложения, запустив сервер на локальном хосте:
    ```bash
    python manage.py runserver
    ```

    После этого сервер будет доступен по адресу: [http://127.0.0.1:8000](http://127.0.0.1:8000).
   
---


## Запуск с использованием Docker
### 1. Настроить Docker окружение
1. Убедиться, что на устройстве установлен Docker и Docker Compose.

    Для установки Docker на Linux:
    ```bash
    sudo apt-get install docker.io
    ```

    Для установки Docker Compose на Linux:
    ```bash
    sudo apt-get install docker-compose
    ```

2. Скопировать файл `.env.example` в `.env` и настроить переменные окружения, такие как:
    ```bash
    DEBUG=True
    SECRET_KEY=secret-key
    DB_NAME=db-name
    DB_USER=db-user
    DB_PASSWORD=db-password
    ```

### 2. Сборка и запуск контейнеров
1. Собрать контейнеры:
    ```bash
    docker-compose build
    ```
    
2. Запустить контейнеры:
    ```bash
    docker-compose up -d
    ```

    Параметр `-d` запускает контейнеры в фоновом режиме.

3. Проверить, что контейнеры работают:
    ```bash
    docker-compose ps
    ```
    Сервер будет доступен по адресу: [http://localhost:8000](http://localhost:8000).


### 3. Миграции базы данных в Docker
1. Применить миграции для базы данных:
    ```bash
    docker-compose exec web python manage.py makemigrations
    docker-compose exec web python manage.py migrate
    ```

2. Для создания суперпользователя в Docker:
    ```bash
    docker-compose exec web python manage.py createsuperuser
    ```

### 4. Остановка контейнеров
1. Остановить контейнеры:
    ```bash
    docker-compose down
    ```
2. Если нужно полностью удалить контейнеры, тома и сеть:
    ```bash
    docker-compose down -v
    ```
---

### Примечание
Docker Compose будет автоматически настраивать Nginx для проксирования запросов к веб-серверу, и статические файлы будут обслуживаться через Nginx.

---


## MVC Эндпоинты
### 1. Главная страница
- **URL**: `/ads/ads/`
- **Описание**: Отображение главной страницы со списком всех объявлений.
- **Что делает**: Загружает основную страницу с общей информацией о проекте, объявлениях и сделках.
- **Ответ**:
    - **200 OK**: Отображает страницу с контентом.
    - **404 Not Found**: Страница не найдена.

---

### 2. Просмотр объявления
- **URL**: `/ads/ads/detail/{ad_id}/`
- **Описание**: Просмотр деталей объявления по его ID.
- **Параметры**:
    - `ad_id` (int): ID объявления.
- **Что делает**: Отображает страницу с полным описанием объявления.
- **Ответ**:
    - **200 OK**: Страница с деталями объявления (заголовок, описание, категория, состояние).
    - **404 Not Found**: Объявление не найдено.

---

### 3. Страница и регистрация пользователя
- **URL**: `/ads/auth/signup/`
- **Описание**: Отображение формы для регистрации нового пользователя.
- - **Тело запроса**:
    - `username` (str): Имя пользователя.
    - `password` (str): Пароль пользователя.
    - `confirm_password` (str): Подтверждение пароль пользователя.
- **Что делает**: Загружает страницу с формой и регистрирует, после, перенаправляет его на главную.
- **Ответ**:
    - **201 Created**: Пользователь успешно зарегистрирован.
    - **400 Bad Request**: Ошибка валидации данных (например, некорректный email или пароль).

---

### 6. Страница входа и авторизация пользователя
- **URL**: `/ads/auth/login/`
- **Описание**: Отображение и обработка данных формы для входа.
- - **Тело запроса**:
    - `username` (string): Имя пользователя.
    - `password` (string): Пароль пользователя.
- **Что делает**: Загружает страницу с формой для авторизации.
- **Ответ**:
    - **200 OK**: Страница формы входа.
    - **404 Not Found**: Страница не найдена.

---

### 7. Страница редактирования объявления
- **URL**: `/ads/ads/edit/{ad_id}/edit/`
- **Описание**: Отображение формы и обработка формы для редактирования объявления.
- **Параметры**:
    - `ad_id` (int): ID объявления.
- **Тело запроса**:
    - `title` (string): Новый заголовок.
    - `description` (string): Новое описание.
    - `category` (string): Новая категория.
    - `condition` (string): Новое состояние.
- **Что делает**: Загружает страницу с формой и обновляет данные объявления и перенаправляет на страницу с деталями 
- **Ответ**:
    - **200 OK**: Объявление успешно обновлено.
    - **404 Not Found**: Объявление не найдено.
    - **400 Bad Request**: Ошибка валидации данных.

---

### 8. Удаление объявления
- **URL**: `/ads/ads/delete/{ad_id}/delete/`
- **Описание**: Удаление объявления.
- **Параметры**:
    - `ad_id` (int): ID объявления.
- **Что делает**: Удаляет указанное объявление из системы.
- **Ответ**:
    - **200 OK**: Объявление успешно удалено.
    - **404 Not Found**: Объявление не найдено.

---

### 9. Страница предложений обмена
- **URL**: `ads/me/my-exchanges/`
- **Описание**: Отображение всех предложений обмена текущего пользователя.
- **Что делает**: Загружает страницу с предложениями обмена.
- **Ответ**:
    - **200 OK**: Страница с предложениями обмена.
    - **404 Not Found**: Страница не найдена.

---

### 10. Страница создания предложения обмена
- **URL**: `/ads/proposals/ad/<int:ad_id>/exchange/`
- **Описание**: Отображение формы и обработка данных формы для создания нового предложения обмена.
- - **Тело запроса**:
    - `ad_receiver` (int): ID объявления, с которым предлагается обмен.
    - `comment` (string): Комментарий к предложению обмена.
- **Что делает**: Загружает страницу и создает новое предложение обмена.
- **Ответ**:
    - **201 Created**: Предложение успешно создано.
    - **400 Bad Request**: Ошибка валидации данных.
    - **404 Not Found**: Страница не найдена.

---

### 14. Обновление статуса предложения обмена
- **URL**: `ads/me/exchange/<int:proposal_id>/<str:new_status>/`
- **Описание**: Изменение статуса предложения обмена (например, принято/отклонено).
- **Параметры**:
    - `proposal_id` (int): ID предложения обмена.
- **Тело запроса**:
    - `status` (string): Новый статус (`accepted`, `rejected`).
- **Ответ**:
    - **200 OK**: Статус обновлен.
    - **404 Not Found**: Предложение не найдено.
---

